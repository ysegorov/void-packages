# Template file for 'polyml'
pkgname=polyml
version=5.9.2
revision=1
build_style=gnu-configure
configure_args="--enable-shared"
makedepends="gmp-devel"
short_desc="Poly/ML Standard ML (SML) implementation"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="LGPL-2.1-or-later"
homepage="http://www.polyml.org/"
distfiles="https://github.com/polyml/polyml/archive/v${version}.tar.gz"
checksum=5cf5f77767568c25cf880acc2d0a32ee3d399e935475ab1626e8192fc3b07390
conflicts="mesa-demos>=0" # /usr/bin/poly
nocross=yes

case "$XBPS_TARGET_MACHINE" in
	i686*)
		# musl doesn't allow writing to .rodata and .text during
		# relocation, but polyexport.o contains DT_TEXTREL
		# since libpolyml/elfexport.cpp only creates absolute
		# relocations.  Drop PIE and do relocations at link time.
		[ "$XBPS_TARGET_LIBC" = "musl" ] && nopie=yes
		;;
	*) makedepends+=" libffi-devel";;
esac

if [ "$XBPS_TARGET_ENDIAN" = "be" ]; then
	broken="crashes"
fi
