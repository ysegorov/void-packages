# Template file for 'gizmo'
pkgname=gizmo
version=0.2.0
revision=1
_commit=f99b8defe8dcb62a47c508caf4e763bcbf6041df
build_style=go
go_import_path=github.com/gizmo-platform/gizmo
go_ldflags="-X ${go_import_path}/pkg/buildinfo.Version=${version}
 -X ${go_import_path}/pkg/buildinfo.Commit=${_commit}"
short_desc="Software for the Gizmo Mechatronics Platform"
maintainer="Michael Aldridge <maldridge@gizmoplatform.org>"
license="ISC"
homepage="https://gizmoplatform.org"
distfiles="https://github.com/gizmo-platform/gizmo/archive/refs/tags/v${version}.tar.gz"
checksum=179e7326342afb752c140fec4ecc7bed116242e998a92644bf86f4ff3b6940d1

post_install() {
	vsv gizmo-fms
	vlicense LICENSE
}

gizmo-fms_package() {
	short_desc+=" - FMS"
	depends="${sourcepkg}>=${version}_${revision} apache-htpasswd dialog terraform"
	make_dirs="/var/lib/gizmo 0755 _gizmo _gizmo"
	system_accounts="_gizmo"
	_gizmo_homedir="/var/lib/gizmo"
	_gizmo_shell="/bin/nologin"
	_gizmo_descr="Unprivileged service account"

	pkg_install() {
		vmove etc/sv/gizmo-fms
	}
}
